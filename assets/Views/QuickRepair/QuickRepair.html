<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=0"/>
    <meta name="format-detection" content="telephone=no,email=no"/>
    <meta name="x5-orientation" content="portrait"/>
    <meta name="x5-fullscreen" content="true"/>
    <meta name="x5-page-mode" content="app"/>
    <title>车服门店</title>
    <script>
        if (window.screen.availWidth <= 750) {
            document.documentElement.style.fontSize = (100 / 750 * window.screen.availWidth) + 'px';
        } else {
            document.documentElement.style.fontSize = '100px';
        }
    </script>
    <link rel="stylesheet" type="text/css" href="../../lib/layer.mobile-v2.0/layer_mobile/need/layer.min.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/base.min.css?v=1.0.3"/>
    <link rel="stylesheet" type="text/css" href="QuickRepair.min.css?v=1.0.8"/>
    <!--公共组件-->
    <link rel="stylesheet" type="text/css" href="../Component/css/count.css"/>
    <style type="text/css">
    	.positioning{
    		z-index: 3;
    	}
    </style>
</head>

<body>

<div class="container" id="app">
    <header>
        <!--<ul class="search_select">-->
        <!--<li>-->
        <!--<span class="area ellipsis">默认▼</span>-->
        <!--</li>-->
        <!--<li>-->
        <!--<span class="sorting ellipsis">默认排序▼</span>-->
        <!--<select class="sorting_select">-->
        <!--<option value="0">默认排序</option>-->
        <!--<option value="1">评分最高</option>-->
        <!--<option value="2">距离最近</option>-->
        <!--</select>-->
        <!--</li>-->
        <!--<li>-->
        <!--<span class="kind ellipsis">默认▼</span>-->
        <!--<select class="kind_select">-->
        <!--<option value="0">默认</option>-->
        <!--<option value="1">一类</option>-->
        <!--<option value="2">二类</option>-->
        <!--<option value="3">三类</option>-->
        <!--<option value="4">保宝车服认证店</option>-->
        <!--</select>-->
        <!--</li>-->
        <!--</ul>-->
        <div class="search_div">
            <span class="icon_search"></span>
            <form id="search_from">
                <input maxlength="48" type="search" class="search_bar" placeholder="请输入您要找的汽修厂"/>
            </form>
            <span class="delete_search">×</span>
        </div>
        <div class="userInfo_prompt">
            完善车型和个人信息，为您推荐更合适的服务<span></span>
        </div>
    </header>
    <div class="repairer_list">
        <ul class="repairer_list_ul"></ul>
    </div>
    
	<!--定位图标-->
	<!-- style="display: inline-block;" -->
    <div class="dwopa" style="display: none;">
		<div class="positioning">
			
		</div>
	    <div class="likeTu">
			<p class="position_text">
				<span></span>
			</p>
		</div>
    </div>
	<!--倒计时组件-->
	<count-block :countblock="countBlock" v-show="isBox" ref="countblock"></count-block>
    
</div>

<script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script src="https://webapi.amap.com/maps?v=1.4.7&key=e9d83bcf337ca24921e9af7aee928b4d"></script>
<script src="../../lib/jQuery 3.3.1/jquery-3.3.1.min.js" charset='utf-8'></script>
<script src="../../lib/fastclick 1.0.6/fastclick.min.js" charset='utf-8'></script>
<script src="../../lib/layer.mobile-v2.0/layer_mobile/layer.min.js" charset='utf-8'></script>
<script src="../../lib/jroll.2.6.1/jroll.min.js" charset='utf-8'></script>
<script src="../../lib/jroll.2.6.1/jroll-pulldown.1.0.0.min.js"></script>
<script src="../../js/vue.min.js"></script>
<script src="../Component/js/count.js"></script>
<script>
    document.write("<script src='../../js/config.js?v=" + Math.random() + "' charset='utf-8'><\/script>");
    document.close();
</script>
<script src="QuickRepair.js?v=1.0.11" charset='utf-8'></script>
<script>
    $(function () {

        app.loading();
        if (api.isDebug) {
            quickRepair();
        } else {
            $.ajax({
                url: api.NWBDApiGetWxTicket + "?r=" + Math.random(),
                type: "POST",
                async: false,
                data: {
                    wxUrl: window.location.href
                },
                success: function (result) {
                    if (result.status === "success" && result.code === 0) {
                        wx.config({
                            debug: api.isDebug,
                            appId: result.data.AppID,
                            timestamp: result.data.timestamp,
                            nonceStr: result.data.noncestr,
                            signature: result.data.signature,
                            jsApiList: [
                            'getLocation', 
                            'hideAllNonBaseMenuItem',
                            'hideOptionMenu',		//	隐藏分享菜单
		        			'checkJsApi',			//	
		        			'onMenuShareTimeline',	//	分享到朋友圈
		        			'onMenuShareAppMessage'	//	分享给朋友
                            ]
                        });
                        wx.ready(function () {
                           
                            quickRepair();
                            
                            //新增分享
                            wx.checkJsApi({
			        			jsApiList:['chooseImage'],	//	需要检测的JS接口列表
			        			success:function(res){
			        				console.log(res)
			        			}
			        		});
			        		
	                        var shareUrl = 'https://wxcs.nuoweibd.com/Views/shareList/share.html?customerId=' + app.getItem('userInfo').id;
	                        var obj = {
			        			//	朋友圈
			        			title:'保宝车服——中国最好的维修地图，赶紧了解一下吧！',	//	标题
			        			desc:'保宝车服——中国最好的维修地图，赶紧了解一下吧！',	//	描述
			        			link:shareUrl,	//	分享链接
			        			imgUrl:'https://wxcs.nuoweibd.com/images/qrhtml.png',	//	分享图标
			        			fail:function(res){
			        				console.log(JSON.stringify(res))
			        			},
			        			success:function(){
			      					alert('分享成功')
			        			},
			        			cancel:function(){
			        			//	alert('分享取消')
			        			}
			        		};
			        		
			        		var obj1 = {
								//	微信朋友
			        			title:'汽车维修不用愁，保宝车服解您愁。',	//	标题
			        			desc:'保宝车服——中国最好的维修地图，赶紧了解一下吧！',	//	描述
			        			link:shareUrl,	//	分享链接
			        			imgUrl:'https://wxcs.nuoweibd.com/images/qrhtml.png',	//	分享图片
			        			fail:function(res){
			        				console.log(JSON.stringify(res))
			        			},
			        			success:function(){
			      				//	alert('分享成功')
			        			},
			        			cancel:function(){
			        			//	alert('分享取消')
			        			}
							};
							
			        		if(!app.getItem('userInfo').id){
//			        			alert(app.getItem('userInfo').id)
			        			wx.hideAllNonBaseMenuItem();	//	隐藏所有非基础按钮
			        		}else{
//			        			wx.showAllNonBaseMenuItem();
			        			wx.onMenuShareTimeline(obj)	//	分享到朋友圈
			        			wx.onMenuShareAppMessage(obj1)	//	分享给朋友
			        		}
			        		
			//      		wx.hideOptionMenu()	//	隐藏分享
                        });
                        wx.error(function (err) {
                            alert("公众号页面授权失败");
                            app.f_close();
                        });
                    } else {
                        alert("获取授权失败：" + result.message);
                        app.f_close();
                    }
                },
                error: function () {
                    alert("网络异常，请检查网络");
                    app.f_close();
                }
            });
        }
    });
</script>
<script type="text/javascript">
	//	新增倒计时
	var vm = new Vue({
		el:'#app',
		data:{
			isBox:false,
			countBlock:{
				min:'00',
				sec:'00',
				numAll:'',
				orderId:localStorage.getItem('orderId')
			},
			countDown:''
		},
		methods:{
			//	转化时间并赋值
			formaFun(a){
				var obj = app.formatDuring(a);
					this.countBlock.min = obj.min;
					this.countBlock.sec = obj.sec;
			},
		 	timer(m){
		   	// 定时器
		   	var tt = setInterval(function(){
		   		m++;

				
		   		localStorage.setItem('num',m)
				   // vm.formatDuring(m)
				   vm.formaFun(m);
		   		if(m == api.pzTime){
		   			// 	指定时间后定时器消失
		   			vm.isBox = false;
		   			clearInterval(tt);
   					localStorage.removeItem('status');
					localStorage.removeItem('num');
					var data = {
						order_id:vm.countBlock.orderId,
						user_id:app.getItem('userInfo').id	//	app.getItem('open_id') '9d8eb665-d810-411b-8ad1-77c341f40038'	
					}
					$.ajax({
						type:"POST",
						url:api.NWBDApiWeiXincancelOrder,
						data:data,
						dataType: 'json',
						success:function(result){
							if(result.code == 0){
								app.alert(result.data)
								localStorage.removeItem('status');
								localStorage.removeItem('num');
							}
						},
						error:function(){
							alert('操作失败，请检查网络！');
			                app.closeLoading();
						}
					});
		   		}
		   	},1000)
		},
			
		},
		mounted(){
			var number1 = app.checkTime()	
			if(number1 != ''){
				this.timer(number1);
			}
			

			//	有未接订单的情况
			var status = localStorage["status"];
			if(status == 1){
				this.isBox = true;
				$('.dwopa').hide();
				this.$refs.countblock.childs();
				
			}else{
				this.isBox = false;
				//	暂时隐藏
				// $('.dwopa').show();
			}
			
		}
	})
</script>
</body>

</html>