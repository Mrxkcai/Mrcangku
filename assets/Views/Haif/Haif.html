<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=0" />
    <meta name="format-detection" content="telephone=yes,email=no" />
    <meta name="x5-orientation" content="portrait" />
    <meta name="x5-fullscreen" content="true" />
    <meta name="x5-page-mode" content="app" />
    <title>注册</title>
    <script>
        if (window.screen.availWidth <= 750) {
            document.documentElement.style.fontSize = (100 / 750 * window.screen.availWidth) + 'px';
        } else {
            document.documentElement.style.fontSize = '100px';
        }
    </script>
    <link rel="stylesheet" type="text/css" href="../../css/base.min.css?v=2.0.3" />
    <link rel="stylesheet" type="text/css" href="Haif.css?v=2.0.0" />
</head>

<body>
    <div id="app" v-cloak>
        <div class="con1" style="position: relative;background: url(&quot;https://app.haiercash.com:6688/hf/html/download/20180627/images/div_bg.png&quot;) 0% 0% / 100% 100% no-repeat;">
            <p style="position: relative; height: 1.5rem;"></p>
            <p class="p2" style="position: relative;">
                <input type="text" name="" placeholder="请输入手机号" maxlength="11" v-model="phone" />
            </p>
            <p class="p3" style="position: relative;">
                <input type="text" name="" placeholder="请输入验证码" maxlength="6" v-model="code" />
                <button type="button" class="a-send noborder" @click="getCode()">获取验证码</button>
            </p>
            <p class="p4" style="position: relative;">
                <input id="pwd" type="password" name="" placeholder="设置登录密码" v-model="pass" />
                <img @click="show()" id="pwd_show" src="https://app.haiercash.com:6688/hf/html/download/20180627/images/show.png">
            </p>
            <p style="position: relative; height: 0.3rem;"></p>
        </div>

        <img src="../../images/regist_btn.png" alt="" class="registe_btn" @click="regist()"/>

        <img src="../../images/regist_bottom.png" alt="" class="regist_bottom" />
        <p style="clear: both;"></p>
    </div>
</body>
<script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script src="../../lib/jQuery 3.3.1/jquery-3.3.1.min.js" charset='utf-8'></script>
<script src="../../lib/fastclick 1.0.6/fastclick.min.js" charset='utf-8'></script>
<script src="../../lib/layer.mobile-v2.0/layer_mobile/layer.min.js" charset='utf-8'></script>
<script src="../../lib/jroll.2.6.1/jroll.min.js" charset='utf-8'></script>
<script src="../../lib/jroll.2.6.1/jroll-pulldown.1.0.0.min.js"></script>
<script src="../../js/vue.min.js"></script>
<script src="../../js/vue-lazyload.js"></script>
<script src="https://webapi.amap.com/maps?v=1.4.7&key=e9d83bcf337ca24921e9af7aee928b4d"></script>
<script>
    document.write("<script src='../../js/config.js?v=" + Math.random() + "' charset='utf-8'><\/script>");
    document.close();
</script>
<script>
    //-layer懒加载页面图片
    Vue.use(VueLazyload, {
        preLoad: 1.3,
        error: '../../images/img_zhanweitu.png',
        loading: '../../images/img_zhanweitu.png',
        attempt: 1
    })
</script>
<script>
    //  -fastclick 用法
    FastClick.attach(document.body);

    var vm = new Vue({
        el: '#app',
        data: {
            phone:"",
            code:'',
            pass:''
        },
        methods: {
            init() {
                //-初始化页面高度
                $("#app").css({ 'min-height': $(window).height() + 'px' });
                var that = this;
                // that.fun('该手机号码已经注册海尔会员，请下载嗨付直接用此手机号码登录',1);
            },
            regist(){
                var that = this;
                if(that.phone == ''){
                    that.fun('请输入手机号');
                    return;
                }else if(that.phone.length > 0 && !/^((17[0-9])|(14[0-9])|(13[0-9])|(15[0-9])|(16[0-9])|(18[0-9])|(19[0-9]))\d{8}$/.test(that.phone)){
                    that.fun('手机号格式不正确');
                    return;
                }else if(that.code == ''){
                    that.fun('请输入验证码');
                    return;
                }else if (that.code.length > 0 && that.code.length < 6){
                    that.fun('验证码格式不正确');
                    return;
                }else if(that.pass == ''){
                    that.fun('请输入登录密码');
                    return;
                }else if(that.pass.length > 0 && !/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,21}$/.test(that.pass)){
                    that.fun('密码由6-20位字母和数字组成');
                    return;
                }else{
                    $.ajax({
                        url:api.NWBDApiHairReg,
                        type:'POST',
                        data:{
                            userId:app.getItem("userInfo").id,
                            type:"WX_USER",
                            mobile:that.phone,
                            verifyNo:that.code,
                            password:that.pass
                        },
                        dataType:"jsonp",
                        success:function(res){
                            console.log(res)
                            if(res.code == 0 && res.status == 'success'){
                                that.fun(res.message,1);
                            }else if(res.code == 2){
                                that.fun(res.message);
                            }else if(res.code == 1){
                                that.fun(res.message,1);
                            }
                            
                        },
                        error:function(){
                            app.alert('网络故障，请稍后重试')
                        }
                    });
                }

                
                
            },
            show(){
                var that = this;
                if($('#pwd').attr('type') == 'password'){
                    $('#pwd').attr('type','text')
                }else if($('#pwd').attr('type') == 'text'){
                    $('#pwd').attr('type','password')
                }
            },
            getCode(){
                var that = this;
                var btn_code = $('.a-send');
                if(/^((17[0-9])|(14[0-9])|(13[0-9])|(15[0-9])|(16[0-9])|(18[0-9])|(19[0-9]))\d{8}$/.test(that.phone)){
                    $.ajax({
                        url:api.NWBDApiHairCode,
                        type:'GET',
                        data:{
                            userId:app.getItem("userInfo").id,
                            type:'WX_USER',
                            mobile:that.phone
                        },
                        dataType:"jsonp",
                        success:function(res){
                            console.log(res)
                            if(res.code == 0 && res.status == 'success'){
                                var time = 60;
                                btn_code.text(time + "后重新获取");
                                btn_code.attr("disabled", true);
                                var timer = setInterval(function () {
                                    time--;
                                    btn_code.text(time + "后重新获取");
                                    if (time <= 0) {
                                        clearInterval(timer);
                                        btn_code.text("获取验证码");
                                        btn_code.attr("disabled", false);
                                    }
                                }, 1000);
                            }else{
                                app.alert(res.message)
                            }
                        },
                        error:function(){
                            app.alert('网络故障，请稍后重试')
                        }
                    })
                }else if(that.phone.length == 0){
                    that.fun('请输入手机号');
                }else if(that.phone.length > 0 && !/^((17[0-9])|(14[0-9])|(13[0-9])|(15[0-9])|(16[0-9])|(18[0-9])|(19[0-9]))\d{8}$/.test(that.phone)){
                    
                    that.fun('手机号格式不正确');
                }else{}
                
            },
            fun(mes,n){
                if(n == 1){
                    var index = layer.open({
                        title:'',
                        style: 'border:none;font-size:0.28rem;',
                        content:'<p>'+mes+'</p>',
                        shadeClose:false,
                        btn:'关闭',
                        shade:0.2,
                        yes:function(){
                            layer.close(index)
                            window.location.href = "https://app.haiercash.com:6688/hf/#!/download/20180627/download.html?c=YONGHUI&fg=null"
                        }
                    });
                    $('.layui-m-layerchild h3').remove();
                }else{
                    var index = layer.open({
                        title:'',
                        style: 'border:none;font-size:0.28rem;',
                        content:'<p>'+mes+'</p>',
                        shadeClose:false,
                        btn:'关闭',
                        shade:0.2,
                        yes:function(){
                            console.log(233)
                            layer.close(index)
                        }
                    });
                    $('.layui-m-layerchild h3').remove();
                }
                
            }
        },
        mounted() {
            var that = this;
            that.init();
        }
    });
</script>

</html>